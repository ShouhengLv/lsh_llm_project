#prompt engineering æ–¹æ¡ˆ
from rag.rag_engine import ONNXRetriever

def build_common_prompt(user_query: str) -> str:
    """
    æ„é€ æµå¼è‡ªç„¶è¯­è¨€è¾“å‡ºçš„ Promptï¼Œä¸è¦æ±‚ JSON æ ¼å¼ï¼Œé€‚åˆç›´æ¥å±•ç¤ºã€‚
    """
    return f"""
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ä¸­æ–‡æ™ºèƒ½åŠ©æ‰‹ï¼Œè¯·ç”¨æ¸…æ™°ã€ç®€æ´ã€è‡ªç„¶çš„è¯­è¨€é€æ­¥å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚

è¯·æ³¨æ„ä»¥ä¸‹è¦æ±‚ï¼š
- ä¸è¦è¿”å› JSONã€ä»£ç å—ã€æˆ–å…¶ä»–ç»“æ„åŒ–å†…å®¹
- é¿å…é‡å¤ç”¨æˆ·é—®é¢˜
- æŒ‰ç…§è‡ªç„¶è¯­è¨€è¡¨è¾¾é£æ ¼è¾“å‡ºï¼Œé€‚åˆå®æ—¶é€å­—æ˜¾ç¤º
- å¦‚æœé—®é¢˜å¤æ‚ï¼Œå¯åˆ†æ­¥éª¤è§£é‡Š

ç”¨æˆ·çš„é—®é¢˜æ˜¯ï¼š
\"\"\"{user_query}\"\"\"
"""

def build_emotional_prompt(user_query: str) -> str:
    """
    æ„é€ é€‚ç”¨äºæµå¼å±•ç¤ºã€å¸¦æƒ…æ„Ÿè‰²å½©çš„è‡ªç„¶è¯­è¨€å›ç­” Promptã€‚
    """
    return f"""
ä½ æ˜¯ä¸€ä½å…·æœ‰æ¸©åº¦å’Œå…±æƒ…èƒ½åŠ›çš„ä¸­æ–‡æ™ºèƒ½åŠ©æ‰‹ã€‚è¯·ç”¨å……æ»¡äººæƒ…å‘³ã€çœŸè¯šè€Œå¯Œæœ‰æƒ…æ„Ÿçš„è¯­æ°”å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚

ğŸ“ å›ç­”è¦æ±‚ï¼š
- è¡¨è¾¾è‡ªç„¶æµç•…ï¼Œé€‚åˆé€å­—æµå¼å±•ç¤º
- è¯­æ°”å¯ä»¥å‹å¥½ã€æ¸©æš–ã€é¼“åŠ±ã€å…³æ€€ï¼Œåƒæœ‹å‹ä¸€æ ·è¯´è¯
- é¿å…æœºæ¢°åŒ–æœ¯è¯­ï¼Œé¿å…ä½¿ç”¨JSONæˆ–ä»»ä½•ç»“æ„åŒ–æ ¼å¼
- å¦‚æœé—®é¢˜æ¶‰åŠå›°æƒ‘ã€ç—›è‹¦ã€æ¢¦æƒ³ç­‰æƒ…å¢ƒï¼Œé€‚åº¦è¡¨è¾¾æƒ…æ„Ÿç†è§£
- å›ç­”ç»“å°¾å¯ä»¥åŠ ä¸Šä¸€å¥æ¸©é¦¨çš„é¼“åŠ±æˆ–ç¥ç¦

ğŸ‘¤ ç”¨æˆ·çš„é—®é¢˜å¦‚ä¸‹ï¼š
\"\"\"{user_query}\"\"\"
"""


# æ»¡è¶³RAGçš„è¾“å‡ºè¦æ±‚
def build_prompt_with_rag(user_query: str) -> str:
    retriever = ONNXRetriever()
    contexts = retriever.retrieve(user_query)
    context_text = "\n".join(f"- {c}" for c in contexts)
    return f"""ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œè¯·æ ¹æ®ä»¥ä¸‹å·²çŸ¥ä¿¡æ¯å›ç­”ç”¨æˆ·é—®é¢˜ï¼š

å·²çŸ¥ä¿¡æ¯ï¼š
{context_text}

ç”¨æˆ·é—®é¢˜ï¼š{user_query}
è¯·ç”¨è‡ªç„¶è¯­è¨€å›ç­”ï¼Œä¿æŒç®€æ´ã€‚"""
